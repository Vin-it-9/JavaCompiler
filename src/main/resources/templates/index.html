<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Compiler</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/darcula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-hue: 160;
            --primary-color: hsl(var(--primary-hue), 84%, 45%);
            --primary-hover: hsl(var(--primary-hue), 84%, 40%);
            --accent-color: hsl(calc(var(--primary-hue) + 20), 84%, 45%);
            --accent-hover: hsl(calc(var(--primary-hue) + 20), 84%, 40%);
            --secondary-color: hsl(calc(var(--primary-hue) + 180), 70%, 55%);
            --surface-1: rgba(30, 41, 59, 0.95);
            --surface-2: rgba(51, 65, 85, 0.9);
            --surface-3: rgba(71, 85, 105, 0.8);
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --glow-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
            --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            min-height: 100vh;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: #f8fafc;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .glass {
            background: rgba(17, 25, 40, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: var(--card-shadow);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .glass-light:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .editor-area {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 280px);
            min-height: 500px;
        }

        @media (max-width: 1024px) {
            .editor-area {
                height: calc(50vh - 100px);
                min-height: 400px;
            }
        }

        /* Monaco Editor container */
        #monaco-editor {
            width: 100%;
            height: 100%;
            flex: 1;
        }

        /* IntelliJ IDEA Glassmorphism Theme */
        .theme-intellij-glass .monaco-editor {
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .theme-intellij-glass .monaco-editor-background {
            background-color: rgba(43, 43, 43, 0.85) !important;
        }

        .theme-intellij-glass .monaco-editor .margin {
            background-color: rgba(43, 43, 43, 0.7) !important;
        }

        .action-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn:active {
            transform: translateY(1px);
        }

        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-btn:hover::after {
            opacity: 1;
        }

        .custom-tab {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .custom-tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
            transform: scaleX(0);
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        .custom-tab.active {
            color: #10b981;
        }
        .custom-tab.active::after {
            transform: scaleX(1);
        }

        .layout-container {
            max-width: 1800px;
            width: 100%;
            margin: 0 auto;
            padding: 0 16px;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(56, 189, 248, 0.2);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(56, 189, 248, 0.4);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .pulse-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .status-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            z-index: 50;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .status-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .resizer {
            height: 100%;
            width: 4px;
            cursor: col-resize;
            background-color: rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s;
        }

        .resizer:hover,
        .resizer:active {
            background-color: rgba(56, 189, 248, 0.4);
        }

        .shortcut-hint {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 20px;
            min-width: 20px;
            padding: 0 4px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-family: var(--font-mono);
            margin-left: 8px;
        }

        .fixed-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        .fixed-run-button {
            background: rgba(16, 185, 129, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fixed-run-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background: rgba(16, 185, 129, 1);
        }

    </style>

    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    mono: ['"JetBrains Mono"', 'Consolas', 'monospace'],
                },
                extend: {
                    colors: {
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        secondary: {
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 ">

<div class="fixed-controls">
    <button id="fixed-run-button" class="fixed-run-button px-4 py-2.5 text-white font-medium flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
        </svg>
        <span id="fixed-run-text">Run</span>
    </button>
</div>

<header class="py-6 relative overflow-hidden">
    <div class="layout-container">
        <div class="text-center relative z-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-400 via-teal-400 to-sky-400 inline-block mb-2">
                Made With Quarkus
            </h1>
            <p class="text-slate-400 max-w-2xl mx-auto text-base sm:text-lg">
                Online Java compiler with performance monitoring
            </p>
        </div>

        <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <div class="absolute top-1/2 left-1/4 w-64 h-64 bg-primary-500/5 rounded-full filter blur-3xl"></div>
            <div class="absolute top-1/3 right-1/4 w-96 h-96 bg-sky-500/5 rounded-full filter blur-3xl"></div>
        </div>
    </div>
</header>

<main class="flex-1 layout-container pb-16">

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

        <div class="glass rounded-xl overflow-hidden">
            <div class="bg-slate-800/80 px-4 py-3 flex items-center justify-between border-b border-slate-700/50">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-sm font-medium text-slate-300">Java Source</span>
                    <span id="char-count" class="text-xs text-slate-500">0 chars</span>
                </div>
                <div class="flex items-center">
                    <select id="theme-select" class="bg-slate-700 text-slate-300 text-xs py-1.5 px-3 rounded-md border border-slate-600 focus:ring-2 focus:ring-primary-500 focus:outline-none">
                        <option value="vs-dark">VS Code</option>
                        <option value="intellij-dark">IntelliJ IDEA</option>
                        <option value="monokai">Monokai</option>
                        <option value="vs">Eclipse</option>
                        <option value="hc-black">High Contrast</option>
                    </select>
                </div>
            </div>
            <div id="editor-container" class="editor-area theme-intellij-glass">

         <textarea id="code-editor" style="display: none;">
import java.util.*;
import java.io.*;

public class Main {
    public static void main(String[] args) {

        System.out.println("Quarkus Supersonic Subatomic Java");


    }
}
</textarea>

                <div id="monaco-editor"></div>
            </div>
        </div>

        <div class="flex flex-col glass rounded-xl overflow-hidden">
            <div class="bg-slate-800/80 border-b border-slate-700/50">
                <div class="flex">
                    <button class="custom-tab active py-3 px-6 text-sm font-medium" data-tab="output">
                        Output
                    </button>
                    <button class="custom-tab py-3 px-6 text-sm font-medium" data-tab="compilation">
                        Compilation
                    </button>
                </div>
            </div>
            <div class="editor-area">
                <div id="output" class="tab-content p-5 h-full overflow-auto font-mono text-sm whitespace-pre-wrap"></div>
                <div id="compilation" class="tab-content p-5 h-full overflow-auto font-mono text-sm whitespace-pre-wrap hidden"></div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Compilation Time</h3>
                <p class="text-3xl font-semibold text-primary-400" id="compilation-time">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="compilation-progress" class="h-full bg-primary-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">milliseconds</div>
        </div>

        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Execution Time</h3>
                <p class="text-3xl font-semibold text-sky-400" id="execution-time">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="execution-progress" class="h-full bg-sky-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">milliseconds</div>
        </div>

        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Memory Usage</h3>
                <p class="text-3xl font-semibold text-purple-400" id="memory-usage">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="memory-progress" class="h-full bg-purple-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">kilobytes</div>
        </div>
    </div>

    <div class="flex flex-wrap justify-center gap-4">
        <button id="run-button" class="action-btn bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-700 hover:to-primary-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-primary-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
            </svg>
            <span id="run-button-text">Compile & Run</span>
            <span class="shortcut-hint">F9</span>
        </button>

        <button id="save-button" class="action-btn bg-gradient-to-r from-sky-600 to-sky-500 hover:from-sky-700 hover:to-sky-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-sky-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
            </svg>
            Save Code
            <span class="shortcut-hint">Ctrl+S</span>
        </button>

        <button id="clear-button" class="action-btn bg-slate-700 hover:bg-slate-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-slate-800/30 border border-slate-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Clear
            <span class="shortcut-hint">Ctrl+K</span>
        </button>
    </div>
</main>

<footer class="py-8 border-t border-slate-800/50">
    <div class="layout-container">
        <div class="text-center">
            <div class="text-slate-600 text-xs mt-2">Press F9 to compile and run your code</div>
        </div>
    </div>
</footer>

<div id="status-toast" class="status-toast bg-slate-900/90 backdrop-blur-sm text-white px-5 py-3 rounded-lg shadow-lg border border-slate-700/50 flex items-center">
    <div id="status-icon" class="mr-3"></div>
    <span id="status-message">Ready</span>
</div>

<script>

    let editor;
    let isRunning = false;

    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' }});

    document.addEventListener('DOMContentLoaded', function() {


        require(['vs/editor/editor.main'], function() {

            monaco.editor.defineTheme('intellij-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [

                    { token: 'comment', foreground: '808080', fontStyle: 'italic' },
                    { token: 'keyword', foreground: 'cc7832', fontStyle: 'bold' },
                    { token: 'string', foreground: '6a8759' },
                    { token: 'number', foreground: '6897bb' },
                    { token: 'identifier', foreground: 'a9b7c6' },
                    { token: 'type.identifier', foreground: 'ffc66d' },
                    { token: 'delimiter', foreground: 'a9b7c6' },
                    { token: 'operator', foreground: 'a9b7c6' }

                ],
                colors: {
                    'editor.background': '#2b2b2b',
                    'editor.foreground': '#a9b7c6',
                    'editorLineNumber.foreground': '#606366',
                    'editorCursor.foreground': '#ffffff',
                    'editor.selectionBackground': '#214283',
                    'editor.lineHighlightBackground': '#323232',
                    'editorBracketHighlight.foreground1': '#FFFF00',
                    'editorBracketHighlight.foreground2': '#00FF00',
                    'editorBracketHighlight.foreground3': '#FF00FF',
                    'editorBracketHighlight.foreground4': '#00FFFF',
                    'editorBracketHighlight.foreground5': '#FF8800',
                    'editorBracketHighlight.foreground6': '#8888FF',
                    'editorBracketHighlight.unexpectedBracket.foreground': '#FF0000'
                }
            });

            monaco.editor.defineTheme('monokai', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '75715e', fontStyle: 'italic' },
                    { token: 'string', foreground: 'e6db74' },
                    { token: 'string.escape', foreground: 'ae81ff' },
                    { token: 'keyword', foreground: 'f92672' },
                    { token: 'keyword.control', foreground: 'f92672', fontStyle: 'bold' },
                    { token: 'keyword.operator', foreground: 'f92672' },
                    { token: 'keyword.import', foreground: 'f92672', fontStyle: 'bold' },
                    { token: 'keyword.package', foreground: 'f92672', fontStyle: 'bold' },
                    { token: 'number', foreground: 'ae81ff' },
                    { token: 'constant.numeric', foreground: 'ae81ff' },
                    { token: 'type', foreground: '66d9ef', fontStyle: 'italic' },
                    { token: 'entity.name.type', foreground: '66d9ef', fontStyle: 'italic' },
                    { token: 'entity.name.class', foreground: 'a6e22e', fontStyle: 'underline' },
                    { token: 'entity.other.inherited-class', foreground: 'a6e22e', fontStyle: 'italic underline' },
                    { token: 'entity.name.function', foreground: 'a6e22e' },
                    { token: 'variable.parameter', foreground: 'fd971f', fontStyle: 'italic' },
                    { token: 'variable', foreground: 'f8f8f2' },
                    { token: 'variable.language', foreground: 'fd971f', fontStyle: 'italic' },
                    { token: 'constant', foreground: 'ae81ff' },
                    { token: 'constant.language', foreground: 'ae81ff', fontStyle: 'italic' },
                    { token: 'storage', foreground: 'f92672' },
                    { token: 'storage.type', foreground: '66d9ef', fontStyle: 'italic' },
                    { token: 'storage.modifier', foreground: 'f92672' },
                    { token: 'annotation', foreground: 'a6e22e', fontStyle: 'italic' },
                    { token: 'punctuation', foreground: 'f8f8f2' },
                    { token: 'delimiter', foreground: 'f8f8f2' }
                ],
                colors: {
                    'editor.background': '#272822',
                    'editor.foreground': '#f8f8f2',
                    'editorLineNumber.foreground': '#8f908a',
                    'editorCursor.foreground': '#f8f8f2',
                    'editor.selectionBackground': '#49483e',
                    'editor.lineHighlightBackground': '#3e3d32',
                    'editorSuggestWidget.background': '#272822',
                    'editorSuggestWidget.border': '#3e3d32',
                    'editorSuggestWidget.foreground': '#f8f8f2',
                    'editorSuggestWidget.selectedBackground': '#49483e',
                    'editorHoverWidget.background': '#272822',
                    'editorHoverWidget.border': '#3e3d32'
                }
            });

            initMonacoEditor();

            document.getElementById('theme-select').value = 'vs-dark';

            document.getElementById('run-button').addEventListener('click', compileAndRun);
            document.getElementById('fixed-run-button').addEventListener('click', compileAndRun);
            document.getElementById('clear-button').addEventListener('click', clearEditor);
            document.getElementById('save-button').addEventListener('click', saveSnippet);

            document.getElementById('theme-select').addEventListener('change', function() {
                const theme = this.value;

                monaco.editor.setTheme(theme);

                const editorContainer = document.getElementById('editor-container');
                if (theme === 'intellij-dark') {
                    editorContainer.className = 'editor-area theme-intellij-glass';
                } else {
                    editorContainer.className = 'editor-area';
                }
            });

            document.querySelectorAll('.custom-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.getAttribute('data-tab'));
                });
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'F9') {
                    e.preventDefault();
                    compileAndRun();
                }

                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveSnippet();
                }

                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    clearEditor();
                }
            });

        });
    });

    // No need to update the above code
    function initMonacoEditor() {

        const initialCode = document.getElementById('code-editor').value;
        const DIAGNOSTICS_DELAY = 300;
        let errorDecorations = [];
        let diagnosticsTimeout = null;

        function updateCharCount() {
            const code = editor.getValue();
            const charCount = code.length;
            document.getElementById('char-count').textContent = charCount;
        }

        monaco.languages.registerCompletionItemProvider('java', {

            triggerCharacters: ['.'],

            provideCompletionItems: function(model, position) {

                const suggestions = [];
                const word = model.getWordUntilPosition(position);

                const range = {
                    startLineNumber: position.lineNumber,
                    endLineNumber: position.lineNumber,
                    startColumn: word.startColumn,
                    endColumn: word.endColumn
                };

                const linePrefix = model.getValueInRange({
                    startLineNumber: position.lineNumber,
                    endLineNumber: position.lineNumber,
                    startColumn: 1,
                    endColumn: position.column
                });

                const keywords = [
                    'abstract', 'assert', 'boolean', 'break', 'byte', 'case', 'catch', 'char',
                    'class', 'const', 'continue', 'default', 'do', 'double', 'else', 'enum',
                    'extends', 'final', 'finally', 'float', 'for', 'if', 'implements', 'import',
                    'instanceof', 'int', 'interface', 'long', 'native', 'new', 'package',
                    'private', 'protected', 'public', 'return', 'short', 'static', 'strictfp',
                    'super', 'switch', 'synchronized', 'this', 'throw', 'throws', 'transient',
                    'try', 'void', 'volatile', 'while', 'true', 'false', 'null',
                    'goto', 'var', 'record','yield','sealed','permits','non-sealed'
                ];

                for (const keyword of keywords) {
                    suggestions.push({
                        label: keyword,
                        kind: monaco.languages.CompletionItemKind.Keyword,
                        insertText: keyword,
                        range: range
                    });
                }

                const javaClasses = [
                    'String', 'Integer', 'Boolean', 'Double', 'Float', 'Long',
                    'Object', 'System', 'Math', 'ArrayList', 'HashMap', 'List',
                    'Map', 'Set', 'Collection', 'Arrays', 'Collections', 'StringBuilder',
                    'StringBuffer', 'Thread', 'Runnable', 'Exception', 'RuntimeException',
                    'Optional', 'Stream', 'Function', 'Consumer', 'Supplier', 'BiFunction',
                    'BigInteger', 'BigDecimal', 'Calendar', 'Date', 'LocalDate', 'LocalTime',
                    'LocalDateTime', 'Path', 'Files', 'Paths', 'ByteBuffer', 'Charset',
                    'Pattern', 'Matcher', 'Scanner', 'PrintWriter', 'BufferedReader',
                    'Character', 'Byte', 'Short', 'Enum', 'TreeMap', 'TreeSet', 'LinkedList',
                    'Queue', 'Deque', 'PriorityQueue', 'HashTable', 'Vector', 'Stack',
                    'Comparable', 'Comparator', 'Serializable', 'Cloneable', 'AutoCloseable',
                    'Iterable', 'Iterator', 'Predicate', 'BiPredicate', 'UnaryOperator', 'BinaryOperator',
                    'Future', 'CompletableFuture', 'Executor', 'ExecutorService', 'ScheduledExecutorService',
                    'Period', 'Duration', 'Instant', 'ZonedDateTime', 'OffsetDateTime', 'YearMonth',
                    'NumberFormat', 'SimpleDateFormat', 'DateTimeFormatter', 'Currency', 'Locale',
                    'Properties', 'UUID', 'URL', 'URI', 'InetAddress', 'Socket', 'ServerSocket',
                    'Runtime', 'Class', 'Void', 'Throwable', 'Error', 'ThreadLocal', 'ClassLoader',
                    'HashSet', 'LinkedHashMap', 'LinkedHashSet', 'EnumSet', 'EnumMap'
                ];

                for (const className of javaClasses) {
                    suggestions.push({
                        label: className,
                        kind: monaco.languages.CompletionItemKind.Class,
                        insertText: className,
                        range: range
                    });
                }

                const snippets = [
                    {
                        label: 'sout',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'System.out.println(${1});',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Print to standard output'
                    },
                    {
                        label: 'ArrayList',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'ArrayList<Integer> arr = new ArrayList<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates an ArrayList instance'
                    },
                    {
                        label: 'psvm',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'public static void main(String[] args) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Main method'
                    },
                    {
                        label: 'main',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'public static void main(String[] args) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Main method'
                    },
                    {
                        label: 'fori',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'for (int i = 0; i < ${1}; i++) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'For loop with index'
                    },
                    {
                        label: 'forEach',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'for (int i : ${1}) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'For-each loop'
                    },
                    {
                        label: 'trycatch',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'try {\n\t${0}\n} catch (Exception e) {\n\te.printStackTrace();\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Try-catch block'
                    },
                    {
                        label: 'if',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'if (${1}) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'If statement'
                    },
                    {
                        label: 'ifelse',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'if (${1}) {\n\t${2}\n} else {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'If-Else statement'
                    },
                    {
                        label: 'while',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'while (${1}) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'While loop'
                    },
                    {
                        label: 'dowhile',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'do {\n\t${0}\n} while (${1});',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Do-While loop'
                    },
                    {
                        label: 'switch',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'switch (${1}) {\n\tcase ${2}:\n\t\t${0}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Switch statement'
                    },

                    {
                        label: 'lambda',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: '(${1}) -> {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Lambda expression'
                    },
                    {
                        label: 'synchronized',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'synchronized (${1}) {\n\t${0}\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Synchronized block'
                    },

                    {
                        label: 'switchExpr',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'var result = switch (${1}) {\n\tcase ${2} -> ${0};\n\tdefault -> throw new IllegalStateException("Unexpected value: " + ${1});\n};',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Switch expression (Java 12+)'
                    },
                    {
                        label: 'LinkedList',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'LinkedList<Integer> list = new LinkedList<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a LinkedList instance'
                    },

                    {
                        label: 'HashMap',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'HashMap<String, Integer> map = new HashMap<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a HashMap instance'
                    }
                    ,{
                        label: 'HashSet',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'HashSet<String> set = new HashSet<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a HashSet instance'
                    },
                    {
                        label: 'TreeMap',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'TreeMap<Integer, String> treeMap = new TreeMap<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a TreeMap instance'
                    },
                    {
                        label: 'PriorityQueue',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'PriorityQueue<Integer> pq = new PriorityQueue<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a PriorityQueue instance'
                    },
                    {
                        label: 'Stack',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'Stack<Integer> stack = new Stack<>();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Creates a Stack instance'
                    }
                ];


                for (const snippet of snippets) {
                    suggestions.push({
                        ...snippet,
                        range: range
                    });
                }

                const dotRange = {
                    startLineNumber: position.lineNumber,
                    endLineNumber: position.lineNumber,
                    startColumn: position.column,
                    endColumn: position.column
                };

                if (linePrefix.endsWith('System.')) {

                    return {
                        suggestions: [
                            {
                                label: 'out',
                                kind: monaco.languages.CompletionItemKind.Field,
                                insertText: 'out',
                                range: dotRange,
                                documentation: 'The standard output stream',
                                sortText: '01'
                            },
                            {
                                label: 'err',
                                kind: monaco.languages.CompletionItemKind.Field,
                                insertText: 'err',
                                range: dotRange,
                                documentation: 'The standard error stream',
                                sortText: '02'
                            },
                            {
                                label: 'currentTimeMillis',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'currentTimeMillis()',
                                range: dotRange,
                                documentation: 'Returns current time in milliseconds',
                                sortText: '04'
                            }
                        ]
                    };
                }

                if (linePrefix.endsWith('System.out.')) {

                    return {
                        suggestions: [
                            {
                                label: 'println',
                                kind: monaco.languages.CompletionItemKind.Field,
                                insertText: 'println();',
                                range: dotRange,
                                documentation: 'The standard output stream',
                                sortText: '01'
                            },
                            {
                                label: 'print();',
                                kind: monaco.languages.CompletionItemKind.Field,
                                insertText: 'print();',
                                range: dotRange,
                                documentation: 'The standard error stream',
                                sortText: '02'
                            },
                            {
                                label: 'currentTimeMillis',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'currentTimeMillis()',
                                range: dotRange,
                                documentation: 'Returns current time in milliseconds',
                                sortText: '04'
                            }
                        ]
                    };
                }

                // Math methods
                if (linePrefix.match(/\bMath\./)) {
                    return {
                        suggestions: [
                            {
                                label: 'random()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'random()',
                                range: dotRange,
                                documentation: 'Returns a random number between 0.0 and 1.0'
                            },
                            {
                                label: 'max()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'max("a","b")',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the greater of two values'
                            },
                            {
                                label: 'min()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'min("a","b")',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the smaller of two values'
                            },
                            {
                                label: 'abs()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'abs()',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the absolute value of a number'
                            },
                            {
                                label: 'ceil()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'ceil()',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the smallest (closest to negative infinity) double value that is greater than or equal to the argument and is equal to a mathematical integer'
                            },
                            {
                                label: 'floor()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'floor()',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the largest (closest to positive infinity) double value that is less than or equal to the argument and is equal to a mathematical integer'
                            },
                            {
                                label: 'round()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'round()',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the closest long to the argument, with ties rounding up'
                            },
                            {
                                label: 'sqrt()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'sqrt()',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the correctly rounded positive square root of a double value'
                            },
                            {
                                label: 'pow()',
                                kind: monaco.languages.CompletionItemKind.Method,
                                insertText: 'pow( , )',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                range: dotRange,
                                documentation: 'Returns the value of the first argument raised to the power of the second argument'
                            }
                        ]
                    };
                }

                return { suggestions };
            }
        });

        function checkJavaSyntax(code) {

            if (!code || !editor || !editor.getModel()) {
                return 0;
            }

            const model = editor.getModel();
            const lines = code.split('\n');
            const errors = [];

            monaco.editor.setModelMarkers(model, 'java-syntax', []);

            const codeState = {
                inMultiLineComment: false,
                inMultiLineString: false,
                braceBalance: 0,
                parenBalance: 0,
                bracketBalance: 0,
                hasPackageDeclaration: false,
                hasClassDeclaration: false,
                hasMainMethod: false,
                importsStartLine: -1,
                importsEndLine: -1,
                classDeclarationLine: -1
            };

            const javaStructure = {
                isComment: (line) => line.trim().startsWith("//") || line.includes("/*"),
                isImport: (line) => line.trim().startsWith("import "),
                isPackage: (line) => line.trim().startsWith("package "),
                isClassDeclaration: (line) => /\b(class|interface|enum)\b/.test(line),
                isMainMethod: (line) => /\bpublic\s+static\s+void\s+main\s*\(\s*String(\s*\[\]|\[\]\s+)\s*\w+\s*\)/.test(line),
                shouldSkipSemicolonCheck: (line) => {
                    return line.match(/\b(if|for|while|switch|try|catch|finally|else)\b/) ||
                        line.match(/\b(class|interface|enum)\b/) ||
                        line.match(/\b(public|private|protected|abstract|static|final|native|synchronized|transient|volatile)\b.*\{/) ||
                    line.match(/\)\s*\{/) ||
                    line.endsWith("{") || line.endsWith("}") ||
                    line.endsWith("(") || line.endsWith(")") ||
                    line.trim() === "";
                },
                needsSemicolon: (line) => {
                    return line.match(/^(return|break|continue|throw)\s+.+/) ||
                        line.match(/^(int|boolean|String|double|float|long|char|byte|short)\s+\w+\s*=.+/) ||
                        line.match(/\w+\s*=\s*.+/) ||
                        line.match(/new\s+\w+\(.+\)/) ||
                        line.match(/^(int|boolean|String|double|float|long|char|byte|short)\s+\w+/);
                }
            };

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                if (line.length === 0) continue;

                if (javaStructure.isPackage(line)) {
                    codeState.hasPackageDeclaration = true;

                    if (i > 2) {
                        errors.push({
                            startLineNumber: i + 1,
                            startColumn: 1,
                            endLineNumber: i + 1,
                            endColumn: lines[i].length + 1,
                            message: 'Package declaration should be at the beginning of the file',
                            severity: monaco.MarkerSeverity.Warning
                        });
                    }
                }

                if (javaStructure.isImport(line)) {
                    if (codeState.importsStartLine === -1) {
                        codeState.importsStartLine = i;
                    }
                    codeState.importsEndLine = i;
                }

                if (javaStructure.isClassDeclaration(line)) {
                    codeState.hasClassDeclaration = true;
                    codeState.classDeclarationLine = i;

                    if (codeState.importsEndLine > i) {
                        errors.push({
                            startLineNumber: codeState.importsEndLine + 1,
                            startColumn: 1,
                            endLineNumber: codeState.importsEndLine + 1,
                            endColumn: lines[codeState.importsEndLine].length + 1,
                            message: 'Import statements should come before class declarations',
                            severity: monaco.MarkerSeverity.Warning
                        });
                    }
                }

                if (javaStructure.isMainMethod(line)) {
                    codeState.hasMainMethod = true;
                }
            }

            if (!codeState.hasPackageDeclaration && codeState.hasClassDeclaration && lines.length > 10) {
                errors.push({
                    startLineNumber: 1,
                    startColumn: 1,
                    endLineNumber: 1,
                    endColumn: 10,
                    message: 'Consider adding a package declaration for better organization',
                    severity: monaco.MarkerSeverity.Hint
                });
            }

            for (let i = 0; i < lines.length; i++) {
                const lineNumber = i + 1;
                const line = lines[i];
                const trimmedLine = line.trim();

                if (trimmedLine.length === 0) continue;

                if (codeState.inMultiLineComment) {
                    if (line.includes("*/")) {
                        codeState.inMultiLineComment = false;
                    }
                    continue;
                }

                if (line.includes("/*")) {
                    codeState.inMultiLineComment = true;
                    if (line.includes("*/")) {
                        codeState.inMultiLineComment = false;
                    }
                    continue;
                }

                if (trimmedLine.startsWith("//")) {
                    continue;
                }

                let processedLine = line;
                const commentIndex = processedLine.indexOf("//");
                if (commentIndex !== -1) {
                    processedLine = processedLine.substring(0, commentIndex);
                }

                if (javaStructure.isClassDeclaration(processedLine)) {
                    codeState.hasClassDeclaration = true;
                }

                if (javaStructure.isMainMethod(processedLine)) {
                    codeState.hasMainMethod = true;
                }

                const skipSemicolonCheck = javaStructure.shouldSkipSemicolonCheck(processedLine);

                if (!processedLine.endsWith(";") && !skipSemicolonCheck && javaStructure.needsSemicolon(processedLine)) {
                    errors.push({
                        startLineNumber: lineNumber,
                        startColumn: 1,
                        endLineNumber: lineNumber,
                        endColumn: line.length + 1,
                        message: 'Missing semicolon',
                        severity: monaco.MarkerSeverity.Error
                    });
                }

                const openBraces = (processedLine.match(/\{/g) || []).length;
                const closeBraces = (processedLine.match(/\}/g) || []).length;
                const openParens = (processedLine.match(/\(/g) || []).length;
                const closeParens = (processedLine.match(/\)/g) || []).length;
                const openBrackets = (processedLine.match(/\[/g) || []).length;
                const closeBrackets = (processedLine.match(/\]/g) || []).length;

                codeState.braceBalance += openBraces - closeBraces;
                codeState.parenBalance += openParens - closeParens;
                codeState.bracketBalance += openBrackets - closeBrackets;

                const skipBraceBalanceWarning =
                    processedLine.match(/\b(class|interface|enum|void)\b/) ||
                    processedLine.match(/\w+\s*\([^)]*\)\s*\{/) ||
                processedLine.match(/\b(public|private|protected)\b.*\(/) ||
                processedLine.match(/\b(if|for|while|switch|try|catch)\b.*\{/) ||
                processedLine.match(/\}\s*else\s*\{/) ||
                processedLine === "}" ||
                processedLine.endsWith("}") ||
                (openBraces === 0 && closeBraces === 0);

                if (openBraces !== closeBraces && !skipBraceBalanceWarning) {
                    errors.push({
                        startLineNumber: lineNumber,
                        startColumn: 1,
                        endLineNumber: lineNumber,
                        endColumn: line.length + 1,
                        message: 'Unbalanced braces in this line',
                        severity: monaco.MarkerSeverity.Warning
                    });
                }

                const skipParenBalanceWarning =
                    processedLine.match(/\b(if|for|while|switch|catch)\b/) ||
                    processedLine.match(/\b(class|interface|enum|void)\b.*\(/) ||
                    processedLine.match(/\w+\s*\([^)]*\)/);

                if (openParens !== closeParens && !skipParenBalanceWarning) {
                    errors.push({
                        startLineNumber: lineNumber,
                        startColumn: 1,
                        endLineNumber: lineNumber,
                        endColumn: line.length + 1,
                        message: 'Unbalanced parentheses in this line',
                        severity: monaco.MarkerSeverity.Warning
                    });
                }

                const skipBracketBalanceWarning =
                    processedLine.match(/\b(String|int|boolean|double|float|long|char|byte|short)\s*\[\]/) ||
                    processedLine.match(/\bnew\b.*\[.*\]/) ||
                    processedLine.match(/\w+\[\s*\d*\s*\]/);

                if (openBrackets !== closeBrackets && !skipBracketBalanceWarning) {
                    errors.push({
                        startLineNumber: lineNumber,
                        startColumn: 1,
                        endLineNumber: lineNumber,
                        endColumn: line.length + 1,
                        message: 'Unbalanced brackets in this line',
                        severity: monaco.MarkerSeverity.Warning
                    });
                }

                let inString = false;
                let escapeNext = false;
                let unclosedString = false;
                let stringStartPos = -1;

                for (let j = 0; j < processedLine.length; j++) {
                    const char = processedLine[j];

                    if (escapeNext) {
                        escapeNext = false;
                        continue;
                    }

                    if (char === '\\' && inString) {
                        escapeNext = true;
                        continue;
                    }

                    if (char === '"') {
                        if (!inString) {
                            stringStartPos = j;
                        }
                        inString = !inString;
                    }
                }

                if (inString) {
                    unclosedString = true;
                    errors.push({
                        startLineNumber: lineNumber,
                        startColumn: stringStartPos + 1,
                        endLineNumber: lineNumber,
                        endColumn: processedLine.length + 1,
                        message: 'Unclosed string literal',
                        severity: monaco.MarkerSeverity.Error
                    });
                }

                const commonTypos = {
                    'pubic': 'public',
                    'statc': 'static',
                    'vod': 'void',
                    'finall': 'final',
                    'retrun': 'return',
                    'NullPointerEception': 'NullPointerException',
                    'Strign': 'String',
                    'excaption': 'exception',
                    'instnaceof': 'instanceof',
                    'syncrhonized': 'synchronized',
                    'thorws': 'throws',
                    'clss': 'class',
                    'boelan': 'boolean',
                    'interafce': 'interface',
                    'implments': 'implements',
                    'extneds': 'extends',
                    'contsructor': 'constructor',
                    'overrride': 'override',
                    'publick': 'public',
                    'prvate': 'private',
                    'proteced': 'protected',
                    'strat': 'start',
                    'runable': 'Runnable',
                    'serializble': 'Serializable',
                    'arraylsit': 'ArrayList',
                    'linkedlsit': 'LinkedList',
                    'hahsmap': 'HashMap',
                    'hastset': 'HashSet',
                    'treeemap': 'TreeMap',
                    'comapator': 'Comparator',
                    'colections': 'Collections',
                    'collctor': 'Collector',
                    'syso': 'System.out.println',
                    'System.out.printin': 'System.out.println',
                    'System.ot.println': 'System.out.println',
                    'lenght': 'length',
                    'lenth': 'length',
                    'foreache': 'forEach',
                    'toSting': 'toString',
                    'StringBuffre': 'StringBuffer',
                    'StringBilder': 'StringBuilder',
                    'equlas': 'equals',
                    'hashcode': 'hashCode',
                    'compareTo': 'compareTo',
                    'compareTto': 'compareTo',
                    'IntStream': 'IntStream',
                    'DoubleStrem': 'DoubleStream'
                };

                if (!line.trim().startsWith("//") && !codeState.inMultiLineComment) {
                    Object.keys(commonTypos).forEach(typo => {
                        const regex = new RegExp('\\b' + typo + '\\b', 'g');
                        let match;
                        let processedForTypos = processedLine;

                        const stringLiterals = processedLine.match(/"[^"]*"/g) || [];
                        stringLiterals.forEach(str => {
                            processedForTypos = processedForTypos.replace(str, ''.padEnd(str.length, ' '));
                        });

                        while ((match = regex.exec(processedForTypos)) !== null) {
                            errors.push({
                                startLineNumber: lineNumber,
                                startColumn: match.index + 1,
                                endLineNumber: lineNumber,
                                endColumn: match.index + typo.length + 1,
                                message: 'Possible typo: \'' + typo + '\'. Did you mean \'' + commonTypos[typo] + '\'?',
                                severity: monaco.MarkerSeverity.Warning
                            });
                        }
                    });
                }

                const javaPatterns = [
                    {
                        pattern: /if\s*\([^)]*\)\s*[^{;]/,
                        message: 'Consider using braces {} around this if block for better readability',
                        severity: monaco.MarkerSeverity.Hint
                    },
                    {
                        pattern: /for\s*\([^)]*\)\s*[^{;]/,
                        message: 'Consider using braces {} around this for loop for better readability',
                        severity: monaco.MarkerSeverity.Hint
                    },
                    {
                        pattern: /catch\s*\([^)]*\)\s*\{[^}]*System\.out\.print/,
                        message: 'Consider using a logger instead of System.out in catch blocks',
                        severity: monaco.MarkerSeverity.Hint
                    },
                    {
                        pattern: /while\s*\(true\)/,
                        message: 'Infinite loop detected. Ensure there is a break condition',
                        severity: monaco.MarkerSeverity.Warning
                    },
                    {
                        pattern: /==\s*(null|".*")/,
                        message: 'Use .equals() to compare objects instead of ==',
                        severity: monaco.MarkerSeverity.Warning
                    }
                ];

                javaPatterns.forEach(({ pattern, message, severity }) => {
                    if (pattern.test(processedLine)) {
                        errors.push({
                            startLineNumber: lineNumber,
                            startColumn: 1,
                            endLineNumber: lineNumber,
                            endColumn: line.length + 1,
                            message: message,
                            severity: monaco.MarkerSeverity[severity]
                        });
                    }
                });
            }

            if (codeState.hasClassDeclaration) {

                if (!codeState.hasMainMethod && lines.length > 20) {
                    errors.push({
                        startLineNumber: codeState.classDeclarationLine + 1,
                        startColumn: 1,
                        endLineNumber: codeState.classDeclarationLine + 1,
                        endColumn: 10,
                        message: 'No main method found. Add "public static void main(String[] args)" for a runnable program.',
                        severity: monaco.MarkerSeverity.Hint
                    });
                }

            }

            if (codeState.braceBalance !== 0) {
                errors.push({
                    startLineNumber: lines.length,
                    startColumn: lines[lines.length - 1].length + 1,
                    endLineNumber: lines.length,
                    endColumn: lines[lines.length - 1].length + 1,
                    message: codeState.braceBalance > 0 ?
                        'Missing ' + codeState.braceBalance + ' closing brace(s) \'}\'' :
                        'Extra ' + Math.abs(codeState.braceBalance) + ' closing brace(s) \'}\'',
                    severity: monaco.MarkerSeverity.Error
                });
            }

            if (codeState.parenBalance !== 0) {
                errors.push({
                    startLineNumber: lines.length,
                    startColumn: lines[lines.length - 1].length + 1,
                    endLineNumber: lines.length,
                    endColumn: lines[lines.length - 1].length + 1,
                    message: codeState.parenBalance > 0 ?
                        'Missing ' + codeState.parenBalance + ' closing parenthesis \')\'' :
                        'Extra ' + Math.abs(codeState.parenBalance) + ' closing parenthesis \')\'',
                    severity: monaco.MarkerSeverity.Error
                });
            }

            if (codeState.bracketBalance !== 0) {
                errors.push({
                    startLineNumber: lines.length,
                    startColumn: lines[lines.length - 1].length + 1,
                    endLineNumber: lines.length,
                    endColumn: lines[lines.length - 1].length + 1,
                    message: codeState.bracketBalance > 0 ?
                        'Missing ' + codeState.bracketBalance + ' closing bracket(s) \']\'' :
                        'Extra ' + Math.abs(codeState.bracketBalance) + ' closing bracket(s) \']\'',
                    severity: monaco.MarkerSeverity.Error
                });
            }

            const codeJoined = lines.join('\n');
            const antiPatterns = [
                {
                    pattern: /catch\s*\([^)]*\)\s*\{\s*\}/g,
                    message: 'Empty catch block found. Consider handling or logging the exception',
                    severity: monaco.MarkerSeverity.Warning
                },
                {
                    pattern: /\/\/\s*TODO|FIXME/g,
                    message: 'TODO/FIXME comment found. Consider resolving before finalizing code',
                    severity: monaco.MarkerSeverity.Hint
                },
                {
                    pattern: /(?:public|private|protected)\s+\w+\s+\w+\s*=\s*null\s*;/g,
                    message: 'Consider initializing class members with proper values instead of null',
                    severity: monaco.MarkerSeverity.Hint
                },
                {
                    pattern: /System\.exit\s*\(\s*[0-1]\s*\)/g,
                    message: 'System.exit() detected. Consider handling termination more gracefully',
                    severity: monaco.MarkerSeverity.Hint
                },
                {
                    pattern: /new\s+Exception\([^)]*\)/g,
                    message: 'Creating generic Exception. Consider using a more specific exception type',
                    severity: monaco.MarkerSeverity.Hint
                }
            ];

            antiPatterns.forEach(({ pattern, message, severity }) => {
                let match;
                while ((match = pattern.exec(codeJoined)) !== null) {

                    let lineIndex = 0;
                    let charCount = 0;
                    while (lineIndex < lines.length && charCount + lines[lineIndex].length + 1 <= match.index) {
                        charCount += lines[lineIndex].length + 1;
                        lineIndex++;
                    }

                    const column = match.index - charCount + 1;

                    errors.push({
                        startLineNumber: lineIndex + 1,
                        startColumn: column,
                        endLineNumber: lineIndex + 1,
                        endColumn: column + match[0].length,
                        message: message,
                        severity: monaco.MarkerSeverity[severity]
                    });
                }
            });

            monaco.editor.setModelMarkers(model, 'java-syntax', errors);

            return errors.length;
        }

        // below code for the intance of the manco
        editor = monaco.editor.create(document.getElementById('monaco-editor'), {
            value: initialCode,
            language: 'java',
            theme: 'vs-dark',
            automaticLayout: true,
            fontSize: 15,
            fontFamily: 'JetBrains Mono, Fira Code, Consolas, "Liberation Mono", Menlo, monospace',
            lineNumbers: 'on',
            minimap: { enabled: false },
            scrollBeyondLastLine: false,
            renderLineHighlight: 'all',
            matchBrackets: 'always',
            autoIndent: 'full',
            formatOnPaste: true,
            tabSize: 4,
            insertSpaces: true,
            renderIndentGuides: true,
            cursorBlinking: 'smooth',
            cursorSmoothCaretAnimation: true,
            smoothScrolling: true,
            mouseWheelZoom: true,
            bracketPairColorization: {
                enabled: true,
                independentColorPoolPerBracketType: true
            },
            formatOnType: true,
            glyphMargin: true,
            lightbulb: {
                enabled: true
            },
            renderValidationDecorations: 'on',
            folding: true,
            foldingStrategy: 'indentation',
            parameterHints: {
                enabled: true
            },
            stickyScroll: {
                enabled: true
            },
            rulers: [80, 120],
            inlayHints: {
                enabled: true
            },
            quickSuggestions: {
                other: true,
                comments: true,
                strings: true
            },
            suggestOnTriggerCharacters: true,
            acceptSuggestionOnEnter: "on",
            tabCompletion: "on",
            renderLineHighlightOnlyWhenFocus: false,
            occurrencesHighlight: true,
            semanticHighlighting: true,
            hover: {
                enabled: true,
                delay: 300,
                sticky: true
            },
            links: true,
            contextmenu: true,
            find: {
                addExtraSpaceOnTop: false,
                autoFindInSelection: "always",
                seedSearchStringFromSelection: "always"
            },
            wordWrap: "on",
            wordWrapColumn: 120,
            codeLens: true,
            definitionLinkOpensInPeek: true,
            multiCursorModifier: "alt",
            columnSelection: false,
            accessibilitySupport: "auto",
            experimental: {
                useUtf8Matcher: true
            },
            diffEditorIgnoreTrimWhitespace: false,
            dragAndDrop: true,
            emptySelectionClipboard: true
        });

        function generateAccessors() {
            const position = editor.getPosition();
            const model = editor.getModel();
            const wordInfo = model.getWordAtPosition(position);

            if (wordInfo && wordInfo.word) {
                const fieldName = wordInfo.word;
                const capitalizedField = fieldName.charAt(0).toUpperCase() + fieldName.slice(1);
                let fieldType = "String";

                if (fieldName.startsWith("is") || fieldName.endsWith("Flag")) {
                    fieldType = "boolean";
                } else if (fieldName.endsWith("Count") || fieldName.endsWith("Id")) {
                    fieldType = "int";
                }

                const getter = "\n\npublic " + fieldType + " get" + capitalizedField + "() {\n\treturn this." + fieldName + ";\n}";
                const setter = "\n\npublic void set" + capitalizedField + "(" + fieldType + " " + fieldName + ") {\n\tthis." + fieldName + " = " + fieldName + ";\n}";

                const insertText = getter + setter;

                editor.executeEdits('generate-accessors', [{
                    range: {
                        startLineNumber: position.lineNumber,
                        startColumn: position.column,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    },
                    text: insertText
                }]);
            }
        }

        setTimeout(function() {
            try {
                editor.addAction({
                    id: 'format-document',
                    label: 'Format Document',
                    keybindings: [
                        monaco.KeyMod.CtrlCmd | monaco.KeyMod.Shift | monaco.KeyCode.KeyF
                    ],
                    run: function() {
                        editor.getAction('editor.action.formatDocument').run();
                        return null;
                    }
                });
                editor.addAction({
                    id: 'toggle-comment',
                    label: 'Toggle Comment',
                    keybindings: [
                        monaco.KeyMod.CtrlCmd | monaco.KeyCode.Slash
                    ],
                    run: function() {
                        editor.getAction('editor.action.commentLine').run();
                        return null;
                    }
                });

            } catch (error) {

            }
        }, 1000);

        function enforceBracketColors() {
            const style = document.createElement('style');
            style.textContent = `
        /* Bracket pair colorization */
        .bracket-highlighting-0 { color: #FFFF00 !important; }
        .bracket-highlighting-1 { color: #00FF00 !important; }
        .bracket-highlighting-2 { color: #FF00FF !important; }
        .bracket-highlighting-3 { color: #00FFFF !important; }
        .bracket-highlighting-4 { color: #FF8800 !important; }
        .bracket-highlighting-5 { color: #8888FF !important; }

        /* Basic syntax highlighting */
        .mtk1 { color: #D4D4D4 !important; } /* default text */
        .mtk7, .mtk8 { color: #569CD6 !important; font-weight: bold; } /* keywords */
        .mtk5, .mtk6 { color: #CE9178 !important; } /* strings */
        .mtk9 { color: #B5CEA8 !important; } /* numbers */
        .mtk10 { color: #4EC9B0 !important; } /* class names */
     `;
            document.head.appendChild(style);
        }

        setTimeout(enforceBracketColors, 500);

        document.getElementById('editor-container').className = 'editor-area';

        editor.onDidChangeModelContent(function() {
            updateCharCount();
            document.getElementById('code-editor').value = editor.getValue();

            clearTimeout(diagnosticsTimeout);
            diagnosticsTimeout = setTimeout(() => {
                checkJavaSyntax(editor.getValue());
            }, DIAGNOSTICS_DELAY);
        });

        monaco.languages.registerHoverProvider('java', {
            provideHover: function(model, position) {
                const markers = monaco.editor.getModelMarkers({
                    resource: model.uri
                });
                for (const marker of markers) {
                    if (marker.startLineNumber <= position.lineNumber &&
                        marker.endLineNumber >= position.lineNumber &&
                        marker.startColumn <= position.column &&
                        marker.endColumn >= position.column) {
                        return {
                            contents: [
                                { value: '**' + (marker.severity === 8 ? 'Error' : marker.severity === 4 ? 'Warning' : 'Info') + '**' },
                                { value: marker.message }
                            ]
                        };
                    }
                }
                return null;
            }
        });

        setTimeout(() => {
            checkJavaSyntax(editor.getValue());
        }, 1000);

        updateCharCount();
    }

    // End of initMonacoEditor function

    function updateCharCount() {
        const count = editor.getValue().length;
        document.getElementById('char-count').textContent = count + ' chars';
    }

    function switchTab(tabId) {
        document.querySelectorAll('.custom-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });

        document.querySelector('.custom-tab[data-tab="' + tabId + '"]').classList.add('active');
        document.getElementById(tabId).classList.remove('hidden');
    }

    function showToast(message, success = true) {
        const toast = document.getElementById('status-toast');
        const icon = document.getElementById('status-icon');
        const messageEl = document.getElementById('status-message');

        messageEl.textContent = message;
        if (success) {
            icon.innerHTML = `
                <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>`;
            toast.classList.add('border-primary-500/50');
            toast.classList.remove('border-rose-500/50');
        } else {
            icon.innerHTML = `
                <svg class="w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`;
            toast.classList.add('border-rose-500/50');
            toast.classList.remove('border-primary-500/50');
        }

        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    function setProgress(elementId, percentage) {
        document.getElementById(elementId).style.width = Math.min(100, percentage) + '%';
    }

    function clearEditor() {
        editor.setValue('import java.util.*;\nimport java.io.*;\n\npublic class Main {\n    public static void main(String[] args) {\n        System.out.println("Quarkus Supersonic Subatomic Java");\n    }\n}');
        document.getElementById('code-editor').value = editor.getValue();
        clearOutputs();
        updateCharCount();
        showToast('Editor cleared and reset to default template');
    }

    function clearOutputs() {
        document.getElementById('output').textContent = '';
        document.getElementById('compilation').textContent = '';
        document.getElementById('compilation-time').textContent = '-';
        document.getElementById('execution-time').textContent = '-';
        document.getElementById('memory-usage').textContent = '-';
        setProgress('compilation-progress', 0);
        setProgress('execution-progress', 0);
        setProgress('memory-progress', 0);

    }

    function compileAndRun() {
        if (isRunning) return;

        isRunning = true;
        const sourceCode = editor.getValue();

        const runBtn = document.getElementById('run-button');
        const fixedRunBtn = document.getElementById('fixed-run-button');
        runBtn.disabled = true;
        fixedRunBtn.disabled = true;
        runBtn.classList.add('opacity-75');
        fixedRunBtn.classList.add('opacity-75');
        document.getElementById('run-button-text').textContent = 'Running...';
        document.getElementById('fixed-run-text').textContent = 'Running...';

        const outputElement = document.getElementById('output');
        outputElement.innerHTML = `
            <div class="flex flex-col items-center justify-center h-full">
                <div class="w-10 h-10 mb-4">
                    <svg class="animate-spin w-full h-full text-primary-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
                <p class="text-slate-400">Compiling and executing your code...</p>
            </div>`;

        clearOutputs();

        fetch('/api/compiler', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                sourceCode: sourceCode,
                language: 'java',
                title: 'Untitled'
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                const compilationElement = document.getElementById('compilation');
                compilationElement.textContent = data.compilationOutput || 'Compilation successful';

                if (!data.compilationSuccess) {
                    compilationElement.classList.add('text-red-400');
                } else {
                    compilationElement.classList.add('text-emerald-400');
                }

                outputElement.textContent = data.executionOutput || 'No output';

                if (!data.executionSuccess && data.compilationSuccess) {
                    outputElement.classList.add('text-red-400');
                }

                animateValue('compilation-time', 0, data.compilationTimeMs, 800);
                const compPercentage = Math.min((data.compilationTimeMs / 1000) * 100, 100);
                setProgress('compilation-progress', compPercentage);

                if (data.compilationSuccess) {
                    animateValue('execution-time', 0, data.executionTimeMs, 800);
                    animateValue('memory-usage', 0, Math.round(data.peakMemoryBytes / 1024), 800);

                    const execPercentage = Math.min((data.executionTimeMs / 1000) * 100, 100);
                    const memPercentage = Math.min(((data.peakMemoryBytes / 1024) / 500) * 100, 100);

                    setProgress('execution-progress', execPercentage);
                    setProgress('memory-progress', memPercentage);
                } else {
                    document.getElementById('execution-time').textContent = '-';
                    document.getElementById('memory-usage').textContent = '-';
                }
                if (!data.compilationSuccess) {
                    switchTab('compilation');
                    showToast('Compilation failed. Check errors.', false);
                } else if (!data.executionSuccess) {
                    switchTab('output');
                    showToast('Execution failed. Check output for errors.', false);
                } else {
                    switchTab('output');
                    showToast('Code executed successfully!', true);
                }
            })
            .catch(error => {
                outputElement.textContent = 'Error: ' + error.message;
                outputElement.classList.add('text-red-400');

                document.getElementById('compilation-time').textContent = '-';
                document.getElementById('execution-time').textContent = '-';
                document.getElementById('memory-usage').textContent = '-';

                showToast('Error: ' + error.message, false);
            })
            .finally(() => {
                isRunning = false;
                runBtn.disabled = false;
                fixedRunBtn.disabled = false;
                runBtn.classList.remove('opacity-75');
                fixedRunBtn.classList.remove('opacity-75');
                document.getElementById('run-button-text').textContent = 'Compile & Run';
                document.getElementById('fixed-run-text').textContent = 'Run';
            });
    }

    function animateValue(elementId, start, end, duration) {
        const element = document.getElementById(elementId);
        const startTime = performance.now();

        if (end == 0) {
            element.textContent = '0';
            return;
        }
        function updateValue(timestamp) {
            const elapsed = timestamp - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easeOutQuad = progress * (2 - progress);

            const currentValue = Math.floor(start + easeOutQuad * (end - start));
            element.textContent = currentValue;

            if (progress < 1) {
                requestAnimationFrame(updateValue);
            } else {
                element.textContent = end;
            }
        }
        requestAnimationFrame(updateValue);
    }

    function saveSnippet() {

        const sourceCode = editor.getValue();
        const title = prompt('Enter filename to save as:', 'Main.java');

        if (!title) return;

        var blobOptions = {};
        blobOptions.type = 'text/plain';
        const blob = new Blob([sourceCode], blobOptions);
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = title;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        showToast('Code saved as ' + title, true);
    }


</script>
</body>
</html>