<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Java Compiler</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/darcula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-hue: 160;
            --primary-color: hsl(var(--primary-hue), 84%, 45%);
            --primary-hover: hsl(var(--primary-hue), 84%, 40%);
            --accent-color: hsl(calc(var(--primary-hue) + 20), 84%, 45%);
            --accent-hover: hsl(calc(var(--primary-hue) + 20), 84%, 40%);
            --secondary-color: hsl(calc(var(--primary-hue) + 180), 70%, 55%);
            --surface-1: rgba(30, 41, 59, 0.95);
            --surface-2: rgba(51, 65, 85, 0.9);
            --surface-3: rgba(71, 85, 105, 0.8);
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --glow-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
            --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            min-height: 100vh;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: #f8fafc;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .glass {
            background: rgba(17, 25, 40, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: var(--card-shadow);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .glass-light:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .editor-area {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 280px);
            min-height: 500px;
        }

        @media (max-width: 1024px) {
            .editor-area {
                height: calc(50vh - 100px);
                min-height: 400px;
            }
        }

        /* Monaco Editor container */
        #monaco-editor {
            width: 100%;
            height: 100%;
            flex: 1;
        }

        /* IntelliJ IDEA Glassmorphism Theme */
        .theme-intellij-glass .monaco-editor {
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .theme-intellij-glass .monaco-editor-background {
            background-color: rgba(43, 43, 43, 0.85) !important;
        }

        .theme-intellij-glass .monaco-editor .margin {
            background-color: rgba(43, 43, 43, 0.7) !important;
        }

        .action-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn:active {
            transform: translateY(1px);
        }

        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-btn:hover::after {
            opacity: 1;
        }

        .custom-tab {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .custom-tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
            transform: scaleX(0);
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        .custom-tab.active {
            color: #10b981;
        }
        .custom-tab.active::after {
            transform: scaleX(1);
        }

        .layout-container {
            max-width: 1800px;
            width: 100%;
            margin: 0 auto;
            padding: 0 16px;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(56, 189, 248, 0.2);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(56, 189, 248, 0.4);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .pulse-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .status-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            z-index: 50;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .status-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .resizer {
            height: 100%;
            width: 4px;
            cursor: col-resize;
            background-color: rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s;
        }

        .resizer:hover,
        .resizer:active {
            background-color: rgba(56, 189, 248, 0.4);
        }

        .shortcut-hint {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 20px;
            min-width: 20px;
            padding: 0 4px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-family: var(--font-mono);
            margin-left: 8px;
        }

        .fixed-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        .fixed-run-button {
            background: rgba(16, 185, 129, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fixed-run-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background: rgba(16, 185, 129, 1);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    mono: ['"JetBrains Mono"', 'Consolas', 'monospace'],
                },
                extend: {
                    colors: {
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        secondary: {
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 ">

<div class="fixed-controls">
    <button id="fixed-run-button" class="fixed-run-button px-4 py-2.5 text-white font-medium flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
        </svg>
        <span id="fixed-run-text">Run</span>
    </button>
</div>

<header class="py-6 relative overflow-hidden">
    <div class="layout-container">
        <div class="text-center relative z-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-400 via-teal-400 to-sky-400 inline-block mb-2">
                Made With Quarkus
            </h1>
            <p class="text-slate-400 max-w-2xl mx-auto text-base sm:text-lg">
                Online Java compiler with performance monitoring
            </p>
        </div>

        <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <div class="absolute top-1/2 left-1/4 w-64 h-64 bg-primary-500/5 rounded-full filter blur-3xl"></div>
            <div class="absolute top-1/3 right-1/4 w-96 h-96 bg-sky-500/5 rounded-full filter blur-3xl"></div>
        </div>
    </div>
</header>

<main class="flex-1 layout-container pb-16">

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

        <div class="glass rounded-xl overflow-hidden">
            <div class="bg-slate-800/80 px-4 py-3 flex items-center justify-between border-b border-slate-700/50">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-sm font-medium text-slate-300">Java Source</span>
                    <span id="char-count" class="text-xs text-slate-500">0 chars</span>
                </div>
                <div class="flex items-center">
                    <select id="theme-select" class="bg-slate-700 text-slate-300 text-xs py-1.5 px-3 rounded-md border border-slate-600 focus:ring-2 focus:ring-primary-500 focus:outline-none">
                        <option value="intellij-dark">IntelliJ IDEA Dark</option>
                        <option value="vs-dark">VS Code Dark</option>
                        <option value="monokai">Monokai</option>
                        <option value="vs">Eclipse</option>
                        <option value="hc-black">High Contrast</option>
                    </select>
                </div>
            </div>
            <div id="editor-container" class="editor-area theme-intellij-glass">

         <textarea id="code-editor" style="display: none;">
import java.util.*;
import java.io.*;

public class Main {
    public static void main(String[] args) {
        System.out.println("Quarkus Supersonic Subatomic Java");
    }
}
</textarea>

                <div id="monaco-editor"></div>
            </div>
        </div>

        <div class="flex flex-col glass rounded-xl overflow-hidden">
            <div class="bg-slate-800/80 border-b border-slate-700/50">
                <div class="flex">
                    <button class="custom-tab active py-3 px-6 text-sm font-medium" data-tab="output">
                        Output
                    </button>
                    <button class="custom-tab py-3 px-6 text-sm font-medium" data-tab="compilation">
                        Compilation
                    </button>
                </div>
            </div>
            <div class="editor-area">
                <div id="output" class="tab-content p-5 h-full overflow-auto font-mono text-sm whitespace-pre-wrap"></div>
                <div id="compilation" class="tab-content p-5 h-full overflow-auto font-mono text-sm whitespace-pre-wrap hidden"></div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Compilation Time</h3>
                <p class="text-3xl font-semibold text-primary-400" id="compilation-time">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="compilation-progress" class="h-full bg-primary-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">milliseconds</div>
        </div>

        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Execution Time</h3>
                <p class="text-3xl font-semibold text-sky-400" id="execution-time">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="execution-progress" class="h-full bg-sky-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">milliseconds</div>
        </div>

        <div class="glass-light p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wider">Memory Usage</h3>
                <p class="text-3xl font-semibold text-purple-400" id="memory-usage">-</p>
            </div>
            <div class="mt-3 h-1.5 w-full bg-slate-700/50 rounded-full overflow-hidden">
                <div id="memory-progress" class="h-full bg-purple-500/70 w-0 rounded-full transition-all duration-1000"></div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-500">kilobytes</div>
        </div>
    </div>

    <div class="flex flex-wrap justify-center gap-4">
        <button id="run-button" class="action-btn bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-700 hover:to-primary-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-primary-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
            </svg>
            <span id="run-button-text">Compile & Run</span>
            <span class="shortcut-hint">F9</span>
        </button>

        <button id="save-button" class="action-btn bg-gradient-to-r from-sky-600 to-sky-500 hover:from-sky-700 hover:to-sky-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-sky-500/20">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
            </svg>
            Save Code
            <span class="shortcut-hint">Ctrl+S</span>
        </button>

        <button id="clear-button" class="action-btn bg-slate-700 hover:bg-slate-600 text-white font-medium px-6 py-3 rounded-lg flex items-center shadow-lg shadow-slate-800/30 border border-slate-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Clear
            <span class="shortcut-hint">Ctrl+K</span>
        </button>
    </div>
</main>

<footer class="py-8 border-t border-slate-800/50">
    <div class="layout-container">
        <div class="text-center">
            <div class="text-slate-600 text-xs mt-2">Press F9 to compile and run your code</div>
        </div>
    </div>
</footer>

<div id="status-toast" class="status-toast bg-slate-900/90 backdrop-blur-sm text-white px-5 py-3 rounded-lg shadow-lg border border-slate-700/50 flex items-center">
    <div id="status-icon" class="mr-3"></div>
    <span id="status-message">Ready</span>
</div>

<script>
    let editor;
    let isRunning = false;


    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' }});

    document.addEventListener('DOMContentLoaded', function() {

        require(['vs/editor/editor.main'], function() {

            monaco.editor.defineTheme('intellij-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '808080' },
                    { token: 'keyword', foreground: 'cc7832', fontStyle: 'bold' },
                    { token: 'string', foreground: '6a8759' },
                    { token: 'number', foreground: '6897bb' },
                    { token: 'operator', foreground: 'a9b7c6' },
                    { token: 'type', foreground: 'ffc66d' },
                    { token: 'identifier', foreground: 'a9b7c6' },
                    { token: 'annotation', foreground: 'bbb529' },
                    { token: 'delimiter', foreground: 'a9b7c6' }
                ],
                colors: {
                    'editor.background': '#2b2b2b',
                    'editor.foreground': '#a9b7c6',
                    'editorLineNumber.foreground': '#606366',
                    'editorCursor.foreground': '#ffffff',
                    'editor.selectionBackground': '#214283',
                    'editor.inactiveSelectionBackground': '#163a6c',
                    'editor.lineHighlightBackground': '#323232',
                    'editorSuggestWidget.background': '#2b2b2b',
                    'editorSuggestWidget.border': '#323232',
                    'editorSuggestWidget.foreground': '#a9b7c6',
                    'editorSuggestWidget.selectedBackground': '#193959',
                    'editorHoverWidget.background': '#2b2b2b',
                    'editorHoverWidget.border': '#323232'
                }
            });

            // Define custom Monokai theme (since you previously had it)
            monaco.editor.defineTheme('monokai', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '75715e' },
                    { token: 'string', foreground: 'e6db74' },
                    { token: 'keyword', foreground: 'f92672' },
                    { token: 'number', foreground: 'ae81ff' },
                    { token: 'type', foreground: '66d9ef', fontStyle: 'italic' }
                ],
                colors: {
                    'editor.background': '#272822',
                    'editor.foreground': '#f8f8f2',
                    'editorLineNumber.foreground': '#8f908a',
                    'editorCursor.foreground': '#f8f8f2',
                    'editor.selectionBackground': '#49483e',
                    'editor.lineHighlightBackground': '#3e3d32'
                }
            });

            initMonacoEditor();

            document.getElementById('run-button').addEventListener('click', compileAndRun);
            document.getElementById('fixed-run-button').addEventListener('click', compileAndRun);
            document.getElementById('clear-button').addEventListener('click', clearEditor);
            document.getElementById('save-button').addEventListener('click', saveSnippet);

            document.getElementById('theme-select').addEventListener('change', function() {
                const theme = this.value;
                monaco.editor.setTheme(theme);

                // Update editor container class for glassmorphism effects
                const editorContainer = document.getElementById('editor-container');
                if (theme === 'intellij-dark') {
                    editorContainer.className = 'editor-area theme-intellij-glass';
                } else {
                    editorContainer.className = 'editor-area';
                }
            });

            document.querySelectorAll('.custom-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.getAttribute('data-tab'));
                });
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'F9') {
                    e.preventDefault();
                    compileAndRun();
                }

                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveSnippet();
                }

                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    clearEditor();
                }
            });
        });
    });

    function initMonacoEditor() {

        const initialCode = document.getElementById('code-editor').value;

        monaco.languages.registerCompletionItemProvider('java', {
            provideCompletionItems: function(model, position) {
                const suggestions = [];
                const word = model.getWordUntilPosition(position);
                const range = {
                    startLineNumber: position.lineNumber,
                    endLineNumber: position.lineNumber,
                    startColumn: word.startColumn,
                    endColumn: word.endColumn
                };

                // Get the text before cursor on current line for context
                const linePrefix = model.getValueInRange({
                    startLineNumber: position.lineNumber,
                    endLineNumber: position.lineNumber,
                    startColumn: 1,
                    endColumn: position.column
                });

                // Java keywords
                const keywords = [
                    'abstract', 'assert', 'boolean', 'break', 'byte', 'case', 'catch', 'char',
                    'class', 'const', 'continue', 'default', 'do', 'double', 'else', 'enum',
                    'extends', 'final', 'finally', 'float', 'for', 'if', 'implements', 'import',
                    'instanceof', 'int', 'interface', 'long', 'native', 'new', 'package',
                    'private', 'protected', 'public', 'return', 'short', 'static', 'strictfp',
                    'super', 'switch', 'synchronized', 'this', 'throw', 'throws', 'transient',
                    'try', 'void', 'volatile', 'while', 'true', 'false', 'null'
                ];

                for (const keyword of keywords) {
                    suggestions.push({
                        label: keyword,
                        kind: monaco.languages.CompletionItemKind.Keyword,
                        insertText: keyword,
                        range: range
                    });
                }

                const javaClasses = [
                    'String', 'Integer', 'Boolean', 'Double', 'Float', 'Long',
                    'Object', 'System', 'Math', 'ArrayList', 'HashMap', 'List',
                    'Map', 'Set', 'Collection', 'Arrays', 'Collections', 'StringBuilder',
                    'StringBuffer', 'Thread', 'Runnable', 'Exception', 'RuntimeException',
                    'Optional', 'Stream', 'Function', 'Consumer', 'Supplier', 'BiFunction',
                    'BigInteger', 'BigDecimal', 'Calendar', 'Date', 'LocalDate', 'LocalTime',
                    'LocalDateTime', 'Path', 'Files', 'Paths', 'ByteBuffer', 'Charset',
                    'Pattern', 'Matcher', 'Scanner', 'PrintWriter', 'BufferedReader',
                    'Character', 'Byte', 'Short', 'Enum', 'TreeMap', 'TreeSet', 'LinkedList',
                    'Queue', 'Deque', 'PriorityQueue', 'HashTable', 'Vector', 'Stack',
                    'Comparable', 'Comparator', 'Serializable', 'Cloneable', 'AutoCloseable',
                    'Iterable', 'Iterator', 'Predicate', 'BiPredicate', 'UnaryOperator', 'BinaryOperator',
                    'Future', 'CompletableFuture', 'Executor', 'ExecutorService', 'ScheduledExecutorService',
                    'Period', 'Duration', 'Instant', 'ZonedDateTime', 'OffsetDateTime', 'YearMonth',
                    'NumberFormat', 'SimpleDateFormat', 'DateTimeFormatter', 'Currency', 'Locale',
                    'Properties', 'UUID', 'URL', 'URI', 'InetAddress', 'Socket', 'ServerSocket'
                ];

                for (const className of javaClasses) {
                    suggestions.push({
                        label: className,
                        kind: monaco.languages.CompletionItemKind.Class,
                        insertText: className,
                        range: range
                    });
                }

                const snippets = [
                    {
                        label: 'sout',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'System.out.println();',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Print to standard output'
                    },
                    {
                        label: 'psvm',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'public static void main(String[] args) {\n\t\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Public static void main'
                    },
                    {
                        label: 'fori',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'for (int i = 0; i < max; i++) {\n\t\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'For loop with index'
                    },
                    {
                        label: 'trycatch',
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: 'try {\n\t\n} catch (Exception e) {\n\te.printStackTrace();\n}',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Try-catch block'
                    }
                ];

                for (const snippet of snippets) {
                    suggestions.push({
                        ...snippet,
                        range: range
                    });
                }

                // Context-aware suggestions
                if (linePrefix.endsWith('System.')) {
                    suggestions.push({
                        label: 'out',
                        kind: monaco.languages.CompletionItemKind.Field,
                        insertText: 'out',
                        range: range,
                        documentation: 'The standard output stream'
                    });

                    suggestions.push({
                        label: 'err',
                        kind: monaco.languages.CompletionItemKind.Field,
                        insertText: 'err',
                        range: range,
                        documentation: 'The standard error stream'
                    });
                }

                if (linePrefix.endsWith('System.out.')) {
                    suggestions.push({
                        label: 'println',
                        kind: monaco.languages.CompletionItemKind.Method,
                        insertText: 'println()',
                        range: range,
                        documentation: 'Print a line of text'
                    });

                    suggestions.push({
                        label: 'print',
                        kind: monaco.languages.CompletionItemKind.Method,
                        insertText: 'print()',
                        range: range,
                        documentation: 'Print text without a newline'
                    });

                    suggestions.push({
                        label: 'printf',
                        kind: monaco.languages.CompletionItemKind.Method,
                        insertText: 'printf("%s", )',
                        range: range,
                        documentation: 'Print formatted text'
                    });
                }

                return { suggestions };
            }
        });

        editor = monaco.editor.create(document.getElementById('monaco-editor'), {
            value: initialCode,
            language: 'java',
            theme: 'intellij-dark',
            automaticLayout: true,
            fontSize: 15,
            fontFamily: 'JetBrains Mono, Consolas, monospace',
            lineNumbers: 'on',
            minimap: { enabled: false },
            scrollBeyondLastLine: false,
            renderLineHighlight: 'all',
            matchBrackets: 'always',
            autoIndent: 'full',
            formatOnPaste: true,
            tabSize: 4,
            insertSpaces: true,
            renderIndentGuides: true,
            cursorBlinking: 'smooth',
            cursorSmoothCaretAnimation: true,
            smoothScrolling: true,
            mouseWheelZoom: true,
            bracketPairColorization: {
                enabled: true
            }
        });

        editor.onDidChangeModelContent(function() {
            updateCharCount();
            document.getElementById('code-editor').value = editor.getValue();
            try {
                localStorage.setItem('javaEditorCode', editor.getValue());
            } catch (e) {
                console.error("Error saving to localStorage", e);
            }
        });

        updateCharCount();

        try {
            const savedCode = localStorage.getItem('javaEditorCode');
            if (savedCode) {
                editor.setValue(savedCode);
                document.getElementById('code-editor').value = savedCode;
            }
        } catch (e) {
            console.error("Error loading from localStorage", e);
        }
    }

    function updateCharCount() {
        const count = editor.getValue().length;
        document.getElementById('char-count').textContent = count + ' chars';
    }

    function switchTab(tabId) {
        document.querySelectorAll('.custom-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });

        document.querySelector('.custom-tab[data-tab="' + tabId + '"]').classList.add('active');
        document.getElementById(tabId).classList.remove('hidden');
    }

    function showToast(message, success = true) {
        const toast = document.getElementById('status-toast');
        const icon = document.getElementById('status-icon');
        const messageEl = document.getElementById('status-message');

        messageEl.textContent = message;

        if (success) {
            icon.innerHTML = `
                    <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>`;
            toast.classList.add('border-primary-500/50');
            toast.classList.remove('border-rose-500/50');
        } else {
            icon.innerHTML = `
                    <svg class="w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`;
            toast.classList.add('border-rose-500/50');
            toast.classList.remove('border-primary-500/50');
        }

        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    function setProgress(elementId, percentage) {
        document.getElementById(elementId).style.width = Math.min(100, percentage) + '%';
    }

    function clearEditor() {
        editor.setValue('import java.util.*;\nimport java.io.*;\n\npublic class Main {\n    public static void main(String[] args) {\n        System.out.println("Quarkus Supersonic Subatomic Java");\n    }\n}');
        document.getElementById('code-editor').value = editor.getValue();
        clearOutputs();
        updateCharCount();
        showToast('Editor cleared and reset to default template');
    }

    function clearOutputs() {
        document.getElementById('output').textContent = '';
        document.getElementById('compilation').textContent = '';
        document.getElementById('compilation-time').textContent = '-';
        document.getElementById('execution-time').textContent = '-';
        document.getElementById('memory-usage').textContent = '-';
        setProgress('compilation-progress', 0);
        setProgress('execution-progress', 0);
        setProgress('memory-progress', 0);
    }

    function compileAndRun() {
        if (isRunning) return;

        isRunning = true;
        const sourceCode = editor.getValue();
        const runBtn = document.getElementById('run-button');
        const fixedRunBtn = document.getElementById('fixed-run-button');
        runBtn.disabled = true;
        fixedRunBtn.disabled = true;
        runBtn.classList.add('opacity-75');
        fixedRunBtn.classList.add('opacity-75');
        document.getElementById('run-button-text').textContent = 'Running...';
        document.getElementById('fixed-run-text').textContent = 'Running...';

        const outputElement = document.getElementById('output');
        outputElement.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full">
                    <div class="w-10 h-10 mb-4">
                        <svg class="animate-spin w-full h-full text-primary-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                    <p class="text-slate-400">Compiling and executing your code...</p>
                </div>`;

        clearOutputs();

        fetch('/api/compiler', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                sourceCode: sourceCode,
                language: 'java',
                title: 'Untitled'
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                const compilationElement = document.getElementById('compilation');
                compilationElement.textContent = data.compilationOutput || 'Compilation successful';

                if (!data.compilationSuccess) {
                    compilationElement.classList.add('text-red-400');
                } else {
                    compilationElement.classList.add('text-emerald-400');
                }

                outputElement.textContent = data.executionOutput || 'No output';

                if (!data.executionSuccess && data.compilationSuccess) {
                    outputElement.classList.add('text-red-400');
                }

                animateValue('compilation-time', 0, data.compilationTimeMs, 800);
                const compPercentage = Math.min((data.compilationTimeMs / 1000) * 100, 100);
                setProgress('compilation-progress', compPercentage);

                if (data.compilationSuccess) {
                    animateValue('execution-time', 0, data.executionTimeMs, 800);
                    animateValue('memory-usage', 0, Math.round(data.peakMemoryBytes / 1024), 800);

                    const execPercentage = Math.min((data.executionTimeMs / 1000) * 100, 100);
                    const memPercentage = Math.min(((data.peakMemoryBytes / 1024) / 500) * 100, 100);

                    setProgress('execution-progress', execPercentage);
                    setProgress('memory-progress', memPercentage);
                } else {
                    document.getElementById('execution-time').textContent = '-';
                    document.getElementById('memory-usage').textContent = '-';
                }
                if (!data.compilationSuccess) {
                    switchTab('compilation');
                    showToast('Compilation failed. Check errors.', false);
                } else if (!data.executionSuccess) {
                    switchTab('output');
                    showToast('Execution failed. Check output for errors.', false);
                } else {
                    switchTab('output');
                    showToast('Code executed successfully!', true);
                }
            })
            .catch(error => {
                outputElement.textContent = 'Error: ' + error.message;
                outputElement.classList.add('text-red-400');

                document.getElementById('compilation-time').textContent = '-';
                document.getElementById('execution-time').textContent = '-';
                document.getElementById('memory-usage').textContent = '-';

                showToast('Error: ' + error.message, false);
            })
            .finally(() => {
                isRunning = false;
                runBtn.disabled = false;
                fixedRunBtn.disabled = false;
                runBtn.classList.remove('opacity-75');
                fixedRunBtn.classList.remove('opacity-75');
                document.getElementById('run-button-text').textContent = 'Compile & Run';
                document.getElementById('fixed-run-text').textContent = 'Run';
            });
    }

    function animateValue(elementId, start, end, duration) {
        const element = document.getElementById(elementId);
        const startTime = performance.now();

        if (end == 0) {
            element.textContent = '0';
            return;
        }
        function updateValue(timestamp) {
            const elapsed = timestamp - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easeOutQuad = progress * (2 - progress);

            const currentValue = Math.floor(start + easeOutQuad * (end - start));
            element.textContent = currentValue;

            if (progress < 1) {
                requestAnimationFrame(updateValue);
            } else {
                element.textContent = end;
            }
        }
        requestAnimationFrame(updateValue);
    }

    function saveSnippet() {
        const sourceCode = editor.getValue();
        const title = prompt('Enter filename to save as:', 'MyJavaCode.java');

        if (!title) return;

        var blobOptions = {};
        blobOptions.type = 'text/plain';
        const blob = new Blob([sourceCode], blobOptions);
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = title;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        showToast('Code saved as ' + title, true);
    }
</script>
</body>
</html>