# ==============================================================================
# Java Online Compiler - Quarkus Configuration
# ==============================================================================
# Optimized for Quarkus 3.31.2 with Java 21 native image builds
# All properties validated against official Quarkus documentation
# ==============================================================================

# ==============================================================================
# HTTP Server Configuration
# ==============================================================================
# Dynamic port binding for Heroku (uses PORT env var in production)
quarkus.http.port=${PORT:8080}
quarkus.http.host=0.0.0.0
quarkus.http.limits.max-body-size=1M

# ==============================================================================
# Qute Template Engine
# ==============================================================================
quarkus.qute.content-types.html=text/html;charset=utf-8

# ==============================================================================
# Logging Configuration
# ==============================================================================
# Development logging
%dev.quarkus.log.level=INFO
%dev.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] %s%e%n

# Production logging (colors disabled for container logs)
%prod.quarkus.log.level=INFO
%prod.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] %s%e%n

# Native build is DISABLED by default (only enabled with -Pnative profile)
# Do NOT enable by default to avoid accidental native builds locally
quarkus.native.enabled=false

# Use container build for cross-platform compatibility
quarkus.native.container-build=true
quarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21

# Disable strict image heap - this is the root cause of the Arc issue
# Quarkus 3.x adds --strict-image-heap which prevents Arc from working
quarkus.native.enable-vm-inspection=false
quarkus.native.auto-service-loader-registration=true
quarkus.native.monitoring=heapdump

# Native image build arguments
# Using ECJ (Eclipse Compiler for Java) - include ECJ resource bundles
quarkus.native.additional-build-args=\
  --initialize-at-build-time=io.quarkus.arc.impl.ArcContainerImpl,\
  --enable-url-protocols=http,\
  --enable-url-protocols=https,\
  -H:+ReportExceptionStackTraces,\
  -H:+AllowFoldMethods,\
  -H:IncludeResourceBundles=org.eclipse.jdt.internal.compiler.batch.messages,\
  -H:IncludeResourceBundles=org.eclipse.jdt.internal.compiler.problem.messages,\
  -H:IncludeResourceBundles=org.eclipse.jdt.core.compiler.batch.messages

# These are ONLY used in development mode with Java 25
# Native builds use Java 21 without preview features
%dev.quarkus.test.arg-line=--enable-preview

# ==============================================================================
# Application Packaging
# ==============================================================================
# Fast JAR packaging for JVM mode (faster startup than uber-jar)
quarkus.package.type=fast-jar

# ==============================================================================
# Development Mode Configuration
# ==============================================================================
%dev.quarkus.http.cors=true
%dev.quarkus.http.access-log.enabled=true
%dev.quarkus.live-reload.instrumentation=false

# ==============================================================================
# Production Optimizations
# ==============================================================================
# Keep unused beans for Arc compatibility
%prod.quarkus.arc.remove-unused-beans=false

# Force index CDI annotations for native image
quarkus.index-dependency.jakarta-cdi.group-id=jakarta.enterprise
quarkus.index-dependency.jakarta-cdi.artifact-id=jakarta.enterprise.cdi-api
quarkus.index-dependency.jakarta-inject.group-id=jakarta.inject
quarkus.index-dependency.jakarta-inject.artifact-id=jakarta.inject-api

# ==============================================================================
# AWS Lambda Configuration (Only used for Lambda deployments)
# ==============================================================================
# Lambda-specific settings - does NOT affect Heroku deployment
%lambda.quarkus.lambda.handler=io.quarkus.amazon.lambda.http.LambdaHttpHandler
%lambda.quarkus.http.root-path=/

# Lambda packaging (produces function.zip for AWS)
%lambda.quarkus.package.type=native

